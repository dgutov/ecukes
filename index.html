---
layout: default
title: Ecukes
---

<div id="header">
  <h1>Ecukes</h1>
  <span class="slogan">Cucumber for Emacs</span>
</div>


<h2>What is Ecukes?</h2>
<p>
  Ecukes is a testing tool for Emacs based on Cucumber. With Ecukes,
  you can write Cucumber-like tests for your Emacs packages.
</p>

<p>
  Step definitions for Ecukes is separated to another package
  called <a href="http://github.com/rejeep/espuds">Espuds</a>.
</p>

<h2>Index</h2>
<ul>
  <li><a href="#example">Example</a></li>
  <li><a href="#projects-using-ecukes">Projects using Ecukes</a></li>
  <li><a href="#get-it">Get it!</a></li>
  <li><a href="#installation">Installation</a></li>
  <li><a href="#usage">Usage</a></li>
  <li><a href="#steps">Steps</a></li>
  <ul>
    <li><a href="#regular-steps">Regular step</a></li>
    <li><a href="#table-steps">Table step</a></li>
    <li><a href="#py-string-steps">Py string step</a></li>
    <li><a href="#calling-steps-from-steps">Calling steps from steps</a></li>
  </ul>
  <li><a href="#hooks">Hooks</a></li>
  <li><a href="#contribution">Contribution</a></li>
  <li><a href="#issues">Issues/Bugs/Feature Requests</a></li>
</ul>


<a name="example"></a>
<h2>Example</h2>
<p>Example from feature in <a href="http://github.com/rejeep/drag-stuff">Drag Stuff</a>.</p>
<code class="example">
  <div class="command">
    <span class="user">user@lap</span>
    <span class="white"> ~/Code/drag-stuff $ ecukes features/line.feature</span>
  </div>

  <div class="feature">
    <div class="header">
      <span class="name">Feature: Drag line</span>
      <ul>
        <li>In order to move a line up and down</li>
        <li>As an Emacs user</li>
        <li>I want to drag it</li>
      </ul>
    </div>

    <div class="background">
      <span class="name">Background:</span>
      <ul>
        <li>Given I am in the buffer "*drag-stuff*"</li>
        <li>And the buffer is empty</li>
        <li>And I insert</li>
        <ul class="py-string">
          <li>"""</li>
          <li>line 1</li>
          <li>line 2</li>
          <li>"""</li>
        </ul>
        <li></li>
        <li></li>
        <li></li>
      </ul>
    </div>

    <div class="scenario">
      <span class="name">Scenario: Drag line up</span>
      <ul>
        <li>When I go to line "2"</li>
        <li>And I press "&lt;M-up&gt;"</li>
        <li>Then I should see:</li>
        <ul class="py-string">
          <li>"""</li>
          <li>line 2</li>
          <li>line 1</li>
          <li>"""</li>
        </ul>
      </ul>
    </div>

    <div class="scenario">
      <span class="name">Scenario: Drag line down</span>
      <ul>
        <li>When I go to line "1"</li>
        <li>And I press "&lt;M-down&gt;"</li>
        <li>Then I should see:</li>
        <ul class="py-string">
          <li>"""</li>
          <li>line 2</li>
          <li>line 1</li>
          <li>"""</li>
        </ul>
      </ul>
    </div>
  </div>

  <div class="stats">
    <ul>
      <li>2 scenarios (<span class="failed">0 failed</span>, <span class="succeded">2 passed</span>)</li>
      <li>11 steps (<span class="failed">0 failed</span>, <span class="succeded">11 passed</span>)</li>
    </ul>
  </div>
</code>


<a name="projects-using-ecukes"></a>
<h2>Projects using Ecukes</h2>
<ul>
  <li><a href="http://github.com/rejeep/drag-stuff">Drag Stuff</a></li>
  <li><a href="http://github.com/rejeep/wrap-region">Wrap Region</a></li>
  <li><a href="http://github.com/rejeep/html-script-src">Html Script Src</a></li>
  <li><a href="http://github.com/rejeep/enclose">Enclose</a></li>
  <li><a href="http://github.com/rejeep/ruby-end">Ruby End</a></li>
  <li><a href="http://github.com/rejeep/ruby-tools">Ruby Tools</a></li>
  <li><a href="https://github.com/magnars/expand-region.el">Expand Region</a></li>
  <li><a href="https://github.com/magnars/buster-mode">Buster Mode</a></li>
  <li><a href="https://github.com/joelmccracken/sauron">Sauron</a></li>
  <li><a href="https://github.com/magnars/multiple-cursors.el">Multiple Cursors</a></li>
  <li><a href="https://github.com/magnars/js2-refactor.el">JS2 Refactor</a></li>
</ul>


<a name="get-it"></a>
<h2>Get it!</h2>
<p>The source for <a href="http://github.com/rejeep/ecukes">Ecukes</a> is available on Github.</p>
<code>
  <a href="http://github.com/rejeep/ecukes">http://github.com/rejeep/ecukes</a>
</code>

<p>As well as the source for <a href="http://github.com/rejeep/espuds">Espuds</a>.</p>
<code>
  <a href="http://github.com/rejeep/espuds">http://github.com/rejeep/espuds</a>
</code>


<a name="installation"></a>
<h2>Installation</h2>

<p>
  Download Ecukes and put the files somewhere in your filesystem. In
  Ecukes root directory, there is an executable
  called <strong>ecukes</strong>. Make sure it's in
  your <strong>PATH</strong>:
</p>

<code>
  $ export PATH="$PATH:/path/to/ecukes"
</code>


<a name="usage"></a>
<h2>Usage</h2>

<p>
  When you have the <strong>ecukes</strong> binary available, you can
  create the Ecukes files for an Emacs project. Lets say you have a
  project called <strong>super-duper</strong> that you want to test
  with Ecukes.
</p>

<pre><code>$ cd /path/to/your/emacs/project
$ ecukes --new</code></pre>

Ecukes creates the <strong>features</strong> directory with these files:

<pre><code>$ ls super-duper

super-duper/
    |-- README
    |-- features
    |   |-- step-definitions
    |   |   `-- super-duper-steps.el
    |   |-- super-duper.feature
    |   `-- support
    |       `-- env.el
    `-- super-duper.el</code></pre>

<p>
  Files in the <strong>support</strong> directory will be loaded
  (<strong>env.el</strong> first, then the rest) each time Ecukes
  run. All files that ends with <strong>-steps.el</strong> in
  the <strong>step-definitions</strong> directory will be loaded as
  step definitions.
</p>

<p>You can run the features in a few different ways.</p>

<ul>
  <li>Run all features in batch mode <strong>ecukes features</strong></li>
  <li>Run all features in graphical mode <strong>ecukes --graphical features</strong></li>
  <li>Run specific feature in batch mode <strong>ecukes features/project.feature</strong></li>
  <li>Run specific features in graphical mode <strong>ecukes --graphical features/awesome-*.feature</strong></li>
</ul>

<a name="steps"></a>
<h2>Steps</h2>
<p>
  There are three different kind of
  steps: <strong>Regular</strong>, <strong>Table</strong>
  and <strong>Py string</strong>.
</p>

<a name="regular-steps"></a>
<h3>Regular Step</h3>

<p>
  A regular step always only consumes one line. The most basic step
  looks like this:
</p>

<code>Given a known state</code>

<p>Corresponding step definition:</p>

<pre><code>(Given "a known state"
     (lambda ()
       ;; Do something
       ))</code></pre>

<p>
  The second argument could also have been the symbol of a function
  name:
</p>

<pre><code>(Given "a known state" 'do-something)</code></pre>

<p>
  Steps can take arbitrary many arguments. The arguments sent to the
  step definition function are all regular expression match groupings
  from the matching of the step name and the match string.
</p>

<p>Single argument:</p>

<pre><code>Given I am in buffer "buffer-name"</code></pre>

<p>Corresponding step definition:</p>
<pre><code>(Given "I am in buffer \"\\(.+\\)\""
   (lambda (buffer-nane)
     ;; Do something with buffer
     ))</code></pre>

<p>Multiple arguments:</p>

<pre><code>Given I am in buffer "buffer-name" with text "Foo"</code></pre>

<p>Corresponding step definition:</p>
<pre><code>(Given "I am in buffer \"\\(.+\\)\" with text \"\\(.+\\)\""
   (lambda (buffer text)
     ;; Do something with buffer and text
     ))</code></pre>


<a name="table-steps"></a>
<h3>Table Step</h3>

<p>A table step looks like this:</p>

<pre><code>Given these meals:
  | meal      | price |
  | Hamburger | $4.50 |
  | Pizza     | $5.30 |</code></pre>

<p>Corresponding step definition:</p>
<pre><code>(Given "these meals:"
       (lambda (meals)
         ;; Do something with text
         ))</code></pre>

<p>
  The argument <strong>meals</strong> is a simple list where
  the <strong>car</strong> of the list is the header and
  the <strong>cdr</strong> or the list is the rows.
</p>

<p>The header would in the above case be:</p>

<code>("meal" "price")</code>

And the rows would be:
<pre><code>(("Hamburger" "$4.50")
 ("Pizza" "$5.30"))</code></pre>

<p>To pick out the header and rows attribute from a table you do:</p>

<pre><code>(let* ((table ...)
       (header (car table))
       (rows   (cdr table)))
  ;; Do something with header and rows
  )</code></pre>

<p>
  It is also possible to send arguments to a table step. The table
  list will be the last argument.
</p>

<pre><code>Given these meals at "fast food":
  | meal      | price |
  | Hamburger | $4.50 |
  | Pizza     | $5.30 |</code></pre>

<p>Corresponding step definition:</p>

<pre><code>(Given "these meals at \"\\(.+\\)\":"
       (lambda (restaurant meals)
         ;; Do something with restaurant and meals
         ))</code></pre>

<a name="py-string-steps"></a>
<h3>Py-string Step</h3>

<p>A Py-String (or Python string) step looks like this:</p>

<pre><code>Given the following text:
  """
  some text
  """</code></pre>

<p>Corresponding step definition:</p>

<pre><code>(Given "the following text:"
       (lambda (text)
         ;; Do something with text
         ))</code></pre>

<p>
  It is also possible to send arguments to a Py-string step. The
  Py-string will be the last argument.
</p>

<pre><code>Given the following text in buffer "buffer-name":
  """
  some text
  """</code></pre>

<p>Corresponding step definition:</p>

<pre><code>(Given "the following text in buffer \"\\(.+\\)\":"
       (lambda (buffer text)
         ;; Do something with buffer and text
         ))</code></pre>

<a name="calling-steps-from-steps"></a>
<h3>Calling steps from steps</h3>

<p>
  In order to keep your steps <strong>DRY</strong>, you can call steps
  from other steps like this:
</p>

<pre><code>(Given "I go to a"
       (lambda ()
         ;; Go to a
         ))

(Given "I go to b"
       (lambda ()
         ;; Go to b
         ))

(Given "I go from a to b"
       (lambda ()
         (Given "I go to a")
         (Given "I go to b")))</code></pre>

<p>You can also pass arguments when calling other steps.</p>
<pre><code>(Given "I am in buffer \"%s\"" "buffer-name")</code></pre>


<a name="hooks"></a>
<h2>Hooks</h2>

<p>
  Ecukes provides four different hooks
</p>

<h3>Setup</h3>
<p>Runs once before anything runs.</p>
<pre><code>(Setup
 ;; Run code
 )</code></pre>

<h3>Before</h3>
<p>Runs once before each step runs.</p>
<pre><code>(Before
 ;; Run code
 )</code></pre>

<h3>After</h3>
<p>Runs once after each step runs.</p>
<pre><code>(After
 ;; Run code
 )</code></pre>

<h3>Teardown</h3>
<p>Runs once when everything is done.</p>
<pre><code>(Teardown
 ;; Run code
 )</code></pre>

<p>
  Hooks are useful if you test your program and change the state in some
  feature. Since all scenarios execute in the same environment, the
  state change will affect all scenarios after. You can solve that by
  resetting the state in a before or after hook.
</p>

<p>
  Hooks should be placed in any file in the
  project <strong>features/support</strong> directory.
</p>

<a name="contribution"></a>
<h2>Contribution</h2>

<p>All contributions are much welcome and appreciated!</p>

<p>
  Before submitting a patch, make sure to write a test for it (if
  possible). Ecukes is tested with a testing framework called Ert (Emacs Lisp
  Regression Testing).
</p>

<p>
  To run the tests, you have to fetch two
  packages: <strong>ert</strong> and <strong>el-mock</strong>.
</p>

<pre><code>$ cd /path/to/ecukes
$ git submodule init
$ git submodule update</code></pre>

<p>Then run the tests with:</p>

<code>$ /path/to/ecukes/test/ecukes-test</code>

<p>You can also run specific tests with:</p>

<code>$ /path/to/ecukes/test/ecukes-test some-test.el ...</code>

<a name="issues"></a>
<h2>Issues/Bugs/Feature Requests</h2>
<p>
  Report on <a href="http://github.com/rejeep/ecukes/issues">Github Issues</a>.
</p>
